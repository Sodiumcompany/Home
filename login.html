<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SODIUM â€¢ Login</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Add Firebase SDK -->
<script type="module">
  // Import Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword,
    onAuthStateChanged,
    signOut 
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { 
    getFirestore, 
    doc, 
    setDoc, 
    getDoc, 
    updateDoc,
    collection,
    query,
    where,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  
  // Your Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAUVsLH-YZdbhnH5U8tuS-31bTrPz6CZ8g",
    authDomain: "sodium-b5392.firebaseapp.com",
    projectId: "sodium-b5392",
    storageBucket: "sodium-b5392.firebasestorage.app",
    messagingSenderId: "21034072519",
    appId: "1:21034072519:web:258c82eb4cfed599c301e2",
    measurementId: "G-E0F44QQMD0"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  
  // Make Firebase available globally
  window.firebaseAuth = { 
    app, auth, db, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword,
    onAuthStateChanged,
    signOut,
    doc, setDoc, getDoc, updateDoc,
    collection, query, where, getDocs
  };
</script>
<style>
:root {
  --bg-dark: #050505;
  --purple: #a855f7;
  --blue: #6366f1;
  --glass: rgba(255, 255, 255, 0.05);
  --glass-border: rgba(255,255,255,0.15);
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
html{scroll-behavior:smooth;}
body{background: var(--bg-dark); color:#fff; overflow-x:hidden; min-height: 100vh; display: flex; flex-direction: column;}

/* Animated Background Blobs */
.blob {position:fixed; border-radius:50%; filter: blur(80px); z-index:-1;}
.blob1{width:500px;height:500px; background:radial-gradient(circle,#a855f780,transparent); top:10%; left:10%; animation:move1 25s infinite alternate;}
.blob2{width:600px;height:600px; background:radial-gradient(circle,#6366f180,transparent); bottom:0; right:5%; animation:move2 30s infinite alternate;}
@keyframes move1{0%{transform:translate(0,0);}100%{transform:translate(50px,60px);}}
@keyframes move2{0%{transform:translate(0,0);}100%{transform:translate(-70px,-40px);}}

/* Header */
header{position:fixed; top:0;width:100%; z-index:1000; display:flex; justify-content:space-between; align-items:center; padding:15px 60px; background: rgba(0,0,0,0.4); backdrop-filter: blur(12px); border-bottom:1px solid rgba(255,255,255,0.1);}
.logo{display: flex; align-items: center; gap: 10px;}
.logo span{font-weight:700; color:var(--purple); letter-spacing:4px; font-size: 24px;}
nav a{margin-left:30px; text-decoration:none;color:#fff;position:relative;}
nav a::after{content:'';position:absolute;left:0;bottom:-4px;width:0;height:2px;background:var(--blue);transition:0.3s;}
nav a:hover::after{width:100%;}

/* Auth Container */
.auth-container {
  display: flex;
  justify-content: center;
  align-items: center;
  flex: 1;
  padding: 120px 20px 60px;
}

.auth-box {
  background: var(--glass);
  backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border);
  border-radius: 24px;
  width: 100%;
  max-width: 450px;
  padding: 40px;
  box-shadow: 0 0 40px rgba(168, 85, 247, 0.2);
  position: relative;
  overflow: hidden;
}

.auth-box::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(135deg, var(--purple), var(--blue));
}

.auth-header {
  text-align: center;
  margin-bottom: 30px;
}

.auth-header h2 {
  font-size: 28px;
  color: #fff;
  margin-bottom: 8px;
}

.auth-header p {
  color: #ccc;
  font-size: 14px;
}

.auth-tabs {
  display: flex;
  margin-bottom: 30px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.tab-btn {
  flex: 1;
  padding: 12px;
  background: transparent;
  border: none;
  color: #aaa;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}

.tab-btn.active {
  color: #fff;
}

.tab-btn.active::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 100%;
  height: 3px;
  background: linear-gradient(135deg, var(--purple), var(--blue));
}

.form-container {
  position: relative;
}

.auth-form {
  display: none;
  animation: fadeIn 0.5s ease;
}

.auth-form.active {
  display: block;
}

.form-group {
  margin-bottom: 20px;
  position: relative;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-size: 14px;
  color: #ccc;
}

.form-input {
  width: 100%;
  padding: 14px 16px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 12px;
  color: #fff;
  font-size: 15px;
  transition: all 0.3s;
}

.form-input:focus {
  outline: none;
  border-color: var(--purple);
  box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2);
}

.input-with-icon {
  position: relative;
}

.input-with-icon i {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: rgba(255,255,255,0.5);
}

.toggle-password {
  background: none;
  border: none;
  color: rgba(255,255,255,0.5);
  cursor: pointer;
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
}

.form-submit {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, var(--purple), var(--blue));
  color: #fff;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 10px;
}

.form-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(168, 85, 247, 0.3);
}

.form-submit:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.auth-footer {
  text-align: center;
  margin-top: 25px;
  padding-top: 20px;
  border-top: 1px solid rgba(255,255,255,0.1);
  color: #aaa;
  font-size: 14px;
}

.auth-footer a {
  color: var(--blue);
  text-decoration: none;
}

/* Loading spinner */
.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
  margin-right: 10px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Message Display */
.message {
  padding: 12px 16px;
  border-radius: 12px;
  margin-bottom: 20px;
  display: none;
  animation: fadeIn 0.3s ease;
}

.message.error {
  background: rgba(239, 68, 68, 0.1);
  color: #f87171;
  border: 1px solid rgba(239, 68, 68, 0.2);
  display: block;
}

.message.success {
  background: rgba(34, 197, 94, 0.1);
  color: #4ade80;
  border: 1px solid rgba(34, 197, 94, 0.2);
  display: block;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes move1{0%{transform:translate(0,0);}100%{transform:translate(50px,60px);}}
@keyframes move2{0%{transform:translate(0,0);}100%{transform:translate(-70px,-40px);}}

/* Responsive */
@media (max-width: 768px) {
  .auth-container {
    padding: 100px 20px 40px;
  }
  
  .auth-box {
    padding: 30px 25px;
  }
  
  header {
    padding: 15px 25px;
  }
}
</style>
</head>
<body>
<div class="blob blob1"></div>
<div class="blob blob2"></div>

<header>
  <div class="logo">
    <span>SODIUM</span>
  </div>
  <nav>
    <a href="index.html">Home</a>
    <a href="#about">About Us</a>
    <a href="#departments">Departments</a>
  </nav>
</header>

<div class="auth-container">
  <div class="auth-box">
    <div class="auth-header">
      <h2>Welcome to SODIUM</h2>
      <p>Join our tech community and access exclusive content</p>
    </div>
    
    <div class="auth-tabs">
      <button class="tab-btn active" data-tab="login">Login</button>
      <button class="tab-btn" data-tab="register">Register</button>
    </div>
    
    <div class="form-container">
      <!-- Login Form -->
      <form id="loginForm" class="auth-form active">
        <div class="message" id="loginMessage"></div>
        
        <div class="form-group">
          <label for="loginEmail">Email Address</label>
          <div class="input-with-icon">
            <input type="email" id="loginEmail" class="form-input" placeholder="Enter your email" required>
            <i class="fas fa-envelope"></i>
          </div>
        </div>
        
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <div class="input-with-icon">
            <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password" required>
            <button type="button" class="toggle-password" id="toggleLoginPassword">
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>
        
        <button type="submit" class="form-submit" id="loginSubmitBtn">
          <span class="btn-text">Login to SODIUM</span>
        </button>
        
        <div class="auth-footer">
          <p>Don't have an account? <a href="#" id="switchToRegister">Sign up here</a></p>
        </div>
      </form>
      
      <!-- Register Form -->
      <form id="registerForm" class="auth-form">
        <div class="message" id="registerMessage"></div>
        
        <div class="form-group">
          <label for="registerName">Full Name</label>
          <div class="input-with-icon">
            <input type="text" id="registerName" class="form-input" placeholder="Enter your full name" required>
            <i class="fas fa-user"></i>
          </div>
        </div>
        
        <div class="form-group">
          <label for="registerUsername">Username</label>
          <div class="input-with-icon">
            <input type="text" id="registerUsername" class="form-input" placeholder="Choose a username" required>
            <i class="fas fa-at"></i>
          </div>
        </div>
        
        <div class="form-group">
          <label for="registerEmail">Email Address</label>
          <div class="input-with-icon">
            <input type="email" id="registerEmail" class="form-input" placeholder="Enter your email" required>
            <i class="fas fa-envelope"></i>
          </div>
        </div>
        
        <div class="form-group">
          <label for="registerPhone">Phone Number</label>
          <div class="input-with-icon">
            <input type="tel" id="registerPhone" class="form-input" placeholder="Enter your phone number" required>
            <i class="fas fa-phone"></i>
          </div>
        </div>
        
        <div class="form-group">
          <label for="registerPassword">Password</label>
          <div class="input-with-icon">
            <input type="password" id="registerPassword" class="form-input" placeholder="Create a password (min. 6 characters)" required minlength="6">
            <button type="button" class="toggle-password" id="toggleRegisterPassword">
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label for="registerConfirmPassword">Confirm Password</label>
          <div class="input-with-icon">
            <input type="password" id="registerConfirmPassword" class="form-input" placeholder="Confirm your password" required minlength="6">
            <i class="fas fa-lock"></i>
          </div>
        </div>
        
        <button type="submit" class="form-submit" id="registerSubmitBtn">
          <span class="btn-text">Create Account</span>
        </button>
        
        <div class="auth-footer">
          <p>Already have an account? <a href="#" id="switchToLogin">Login here</a></p>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
// Wait for Firebase to load
document.addEventListener('DOMContentLoaded', async () => {
  // Wait for Firebase to be available
  await new Promise(resolve => {
    const checkFirebase = setInterval(() => {
      if (window.firebaseAuth) {
        clearInterval(checkFirebase);
        resolve();
      }
    }, 100);
  });
  
  const { 
    auth, db, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword,
    onAuthStateChanged,
    doc, setDoc, getDoc, updateDoc,
    collection, query, where, getDocs
  } = window.firebaseAuth;
  
  // Check if user is already logged in
  onAuthStateChanged(auth, (user) => {
    if (user) {
      // User is signed in, redirect to member page
      window.location.href = 'member.html';
    }
  });
  
  // Tab Switching
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.getAttribute('data-tab');
      
      // Update active tab button
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      // Show corresponding form
      document.querySelectorAll('.auth-form').forEach(form => {
        form.classList.remove('active');
      });
      document.getElementById(`${tab}Form`).classList.add('active');
      
      // Clear messages
      document.getElementById('loginMessage').style.display = 'none';
      document.getElementById('registerMessage').style.display = 'none';
    });
  });
  
  // Switch between forms
  document.getElementById('switchToRegister').addEventListener('click', (e) => {
    e.preventDefault();
    document.querySelector('[data-tab="register"]').click();
  });
  
  document.getElementById('switchToLogin').addEventListener('click', (e) => {
    e.preventDefault();
    document.querySelector('[data-tab="login"]').click();
  });
  
  // Toggle password visibility
  function togglePassword(inputId, toggleBtnId) {
    const passwordInput = document.getElementById(inputId);
    const toggleBtn = document.getElementById(toggleBtnId);
    
    toggleBtn.addEventListener('click', () => {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      
      // Toggle eye icon
      const icon = toggleBtn.querySelector('i');
      if (type === 'text') {
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    });
  }
  
  // Initialize password toggles
  togglePassword('loginPassword', 'toggleLoginPassword');
  togglePassword('registerPassword', 'toggleRegisterPassword');
  togglePassword('registerConfirmPassword', 'toggleRegisterPassword');
  
  // Show message function
  function showMessage(elementId, message, type) {
    const messageEl = document.getElementById(elementId);
    messageEl.textContent = message;
    messageEl.className = `message ${type}`;
    messageEl.style.display = 'block';
    
    // Auto hide after 5 seconds
    setTimeout(() => {
      messageEl.style.display = 'none';
    }, 5000);
  }
  
  // Loading state for buttons
  function setLoading(buttonId, isLoading) {
    const button = document.getElementById(buttonId);
    const btnText = button.querySelector('.btn-text');
    
    if (isLoading) {
      button.disabled = true;
      btnText.innerHTML = `<span class="spinner"></span> Processing...`;
    } else {
      button.disabled = false;
      if (buttonId === 'loginSubmitBtn') {
        btnText.textContent = 'Login to SODIUM';
      } else {
        btnText.textContent = 'Create Account';
      }
    }
  }
  
  // Check if username already exists
  async function checkUsernameExists(username) {
    try {
      const usersRef = collection(db, 'users');
      const q = query(usersRef, where('username', '==', username));
      const querySnapshot = await getDocs(q);
      return !querySnapshot.empty;
    } catch (error) {
      console.error('Error checking username:', error);
      return false;
    }
  }
  
  // Handle Registration
  document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Get form values
    const name = document.getElementById('registerName').value.trim();
    const username = document.getElementById('registerUsername').value.trim().toLowerCase();
    const email = document.getElementById('registerEmail').value.trim();
    const phone = document.getElementById('registerPhone').value.trim();
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('registerConfirmPassword').value;
    
    // Validation
    if (!name || !username || !email || !phone || !password || !confirmPassword) {
      showMessage('registerMessage', 'All fields are required', 'error');
      return;
    }
    
    if (password !== confirmPassword) {
      showMessage('registerMessage', 'Passwords do not match', 'error');
      return;
    }
    
    if (password.length < 6) {
      showMessage('registerMessage', 'Password must be at least 6 characters', 'error');
      return;
    }
    
    // Simple email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      showMessage('registerMessage', 'Please enter a valid email address', 'error');
      return;
    }
    
    // Set loading state
    setLoading('registerSubmitBtn', true);
    
    try {
      // Check if username already exists
      const usernameExists = await checkUsernameExists(username);
      if (usernameExists) {
        showMessage('registerMessage', 'Username already taken. Please choose another.', 'error');
        setLoading('registerSubmitBtn', false);
        return;
      }
      
      // 1. Create user in Firebase Authentication
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      
      // 2. Save additional user data to Firestore
      const userData = {
        uid: user.uid,
        name: name,
        username: username,
        email: email,
        phone: phone,
        createdAt: new Date().toISOString(),
        lastLogin: new Date().toISOString(),
        role: 'member',
        status: 'active'
      };
      
      await setDoc(doc(db, 'users', user.uid), userData);
      
      // Show success message
      showMessage('registerMessage', 'Account created successfully! Redirecting...', 'success');
      
      // Small delay before redirect
      setTimeout(() => {
        window.location.href = 'member.html';
      }, 1500);
      
    } catch (error) {
      console.error('Registration error:', error);
      
      // Handle Firebase errors
      let errorMessage = 'Registration failed. Please try again.';
      
      if (error.code === 'auth/email-already-in-use') {
        errorMessage = 'Email already registered. Please login instead.';
      } else if (error.code === 'auth/invalid-email') {
        errorMessage = 'Invalid email address.';
      } else if (error.code === 'auth/weak-password') {
        errorMessage = 'Password is too weak. Please use a stronger password.';
      } else if (error.code === 'auth/network-request-failed') {
        errorMessage = 'Network error. Please check your internet connection.';
      }
      
      showMessage('registerMessage', errorMessage, 'error');
      setLoading('registerSubmitBtn', false);
    }
  });
  
  // Handle Login
  document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    
    if (!email || !password) {
      showMessage('loginMessage', 'Please enter email and password', 'error');
      return;
    }
    
    // Set loading state
    setLoading('loginSubmitBtn', true);
    
    try {
      // Sign in with Firebase
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      
      // Update last login in Firestore
      const userRef = doc(db, 'users', user.uid);
      await updateDoc(userRef, {
        lastLogin: new Date().toISOString()
      });
      
      // Show success message
      showMessage('loginMessage', 'Login successful! Redirecting...', 'success');
      
      // Small delay before redirect
      setTimeout(() => {
        window.location.href = 'member.html';
      }, 1000);
      
    } catch (error) {
      console.error('Login error:', error);
      
      // Handle Firebase errors
      let errorMessage = 'Login failed. Please try again.';
      
      if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
        errorMessage = 'Invalid email or password.';
      } else if (error.code === 'auth/invalid-email') {
        errorMessage = 'Invalid email address.';
      } else if (error.code === 'auth/user-disabled') {
        errorMessage = 'This account has been disabled.';
      } else if (error.code === 'auth/network-request-failed') {
        errorMessage = 'Network error. Please check your internet connection.';
      } else if (error.code === 'auth/too-many-requests') {
        errorMessage = 'Too many failed attempts. Please try again later.';
      }
      
      showMessage('loginMessage', errorMessage, 'error');
      setLoading('loginSubmitBtn', false);
    }
  });
});
</script>
</body>
</html>

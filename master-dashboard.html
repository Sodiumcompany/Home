<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SODIUM • Master Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Add Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { 
    getFirestore, 
    collection, 
    getDocs, 
    doc, 
    getDoc, 
    updateDoc,
    query,
    where
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyAUVsLH-YZdbhnH5U8tuS-31bTrPz6CZ8g",
    authDomain: "sodium-b5392.firebaseapp.com",
    projectId: "sodium-b5392",
    storageBucket: "sodium-b5392.firebasestorage.app",
    messagingSenderId: "21034072519",
    appId: "1:21034072519:web:258c82eb4cfed599c301e2",
    measurementId: "G-E0F44QQMD0"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  
  window.firebaseAdmin = { 
    app, auth, db, 
    collection, getDocs, doc, getDoc, updateDoc,
    query, where, signOut
  };
</script>
<style>
:root {
  --bg-dark: #050505;
  --purple: #a855f7;
  --blue: #6366f1;
  --glass: rgba(255, 255, 255, 0.05);
  --glass-border: rgba(255,255,255,0.15);
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --gold: #fbbf24;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
html{scroll-behavior:smooth;}
body{background: var(--bg-dark); color:#fff; overflow-x:hidden;}

/* Animated Background Blobs */
.blob {position:fixed; border-radius:50%; filter: blur(80px); z-index:-1;}
.blob1{width:500px;height:500px; background:radial-gradient(circle,#a855f780,transparent); top:10%; left:10%; animation:move1 25s infinite alternate;}
.blob2{width:600px;height:600px; background:radial-gradient(circle,#6366f180,transparent); bottom:0; right:5%; animation:move2 30s infinite alternate;}
@keyframes move1{0%{transform:translate(0,0);}100%{transform:translate(50px,60px);}}
@keyframes move2{0%{transform:translate(0,0);}100%{transform:translate(-70px,-40px);}}

/* Header */
header {
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 60px;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--purple), var(--blue));
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 20px;
}

.logo-text {
  font-weight: 700;
  color: #fff;
  font-size: 22px;
  letter-spacing: 2px;
}

.logo-text span {
  color: var(--purple);
}

.admin-badge {
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  color: #000;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  margin-left: 10px;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 15px;
}

.back-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  background: rgba(255,255,255,0.1);
  color: #fff;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  text-decoration: none;
}

.back-btn:hover {
  background: rgba(255,255,255,0.2);
  transform: translateY(-2px);
}

.user-avatar {
  width: 45px;
  height: 45px;
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: #000;
  cursor: pointer;
}

/* Master Dashboard */
.dashboard {
  padding: 150px 60px 60px;
  max-width: 1600px;
  margin: 0 auto;
}

/* Admin Banner */
.admin-banner {
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
  border: 1px solid rgba(251, 191, 36, 0.3);
  border-radius: 24px;
  padding: 40px;
  margin-bottom: 40px;
  position: relative;
  overflow: hidden;
}

.admin-banner h1 {
  font-size: 36px;
  margin-bottom: 10px;
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  display: flex;
  align-items: center;
  gap: 15px;
}

.admin-banner p {
  color: #ccc;
  font-size: 16px;
  max-width: 600px;
  margin-bottom: 30px;
}

/* Stats Cards */
.admin-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.admin-stat-card {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 16px;
  padding: 25px;
  text-align: center;
  transition: all 0.3s;
}

.admin-stat-card:hover {
  transform: translateY(-5px);
  border-color: var(--gold);
  box-shadow: 0 10px 20px rgba(251, 191, 36, 0.2);
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 5px;
  color: var(--gold);
}

.stat-label {
  font-size: 14px;
  color: #aaa;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.stat-icon {
  font-size: 28px;
  margin-bottom: 15px;
  color: var(--gold);
}

/* Admin Actions */
.admin-actions {
  display: flex;
  gap: 15px;
  margin-top: 20px;
  flex-wrap: wrap;
}

.admin-btn {
  padding: 12px 24px;
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  color: #000;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.admin-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(251, 191, 36, 0.3);
}

.admin-btn.secondary {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.2);
  color: #ccc;
}

.admin-btn.secondary:hover {
  background: rgba(255,255,255,0.05);
  border-color: var(--gold);
  color: #fff;
}

.admin-btn.danger {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.2);
  color: #f87171;
}

.admin-btn.danger:hover {
  background: rgba(239, 68, 68, 0.2);
  border-color: var(--danger);
}

/* Dashboard Grid */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 30px;
  margin-top: 40px;
}

.admin-card {
  background: var(--glass);
  backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  padding: 30px;
  transition: all 0.3s;
}

.admin-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 20px 40px rgba(251, 191, 36, 0.2);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.card-header h3 {
  font-size: 20px;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card-header .badge {
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  color: #000;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

/* Form Inputs */
.form-input {
  width: 100%;
  padding: 12px 16px;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  color: #fff;
  font-size: 14px;
  transition: all 0.3s;
}

.form-input:focus {
  outline: none;
  border-color: var(--gold);
  box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2);
}

/* Admin Role Options */
.admin-role-option {
  background: rgba(255,255,255,0.03);
  border: 2px solid rgba(255,255,255,0.1);
  border-radius: 12px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.3s;
}

.admin-role-option:hover {
  background: rgba(255,255,255,0.05);
  border-color: var(--gold);
  transform: translateY(-2px);
}

.admin-role-option.selected {
  background: rgba(251, 191, 36, 0.1);
  border-color: var(--gold);
}

/* Message Display */
.message {
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 20px;
  display: none;
}

.message.success {
  background: rgba(16, 185, 129, 0.1);
  color: #4ade80;
  border: 1px solid rgba(16, 185, 129, 0.2);
  display: block;
}

.message.error {
  background: rgba(239, 68, 68, 0.1);
  color: #f87171;
  border: 1px solid rgba(239, 68, 68, 0.2);
  display: block;
}

/* Loading */
.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 70vh;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(255,255,255,0.1);
  border-radius: 50%;
  border-top-color: var(--gold);
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 1200px) {
  .dashboard {
    padding: 140px 40px 40px;
  }
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  header {
    padding: 15px 25px;
  }
  .dashboard {
    padding: 130px 25px 40px;
  }
  .admin-banner {
    padding: 30px 25px;
  }
  .admin-stats {
    grid-template-columns: repeat(2, 1fr);
  }
  .admin-actions {
    flex-direction: column;
  }
}

@media (max-width: 576px) {
  .admin-stats {
    grid-template-columns: 1fr;
  }
  .logo-text {
    font-size: 18px;
  }
}
</style>
</head>
<body>
<div class="blob blob1"></div>
<div class="blob blob2"></div>

<header>
  <div class="logo">
    <div class="logo-icon">S</div>
    <div class="logo-text">SOD<span>IUM</span><span class="admin-badge"><i class="fas fa-crown"></i> MASTER</span></div>
  </div>
  
  <div class="header-actions">
    <a href="member.html" class="back-btn">
      <i class="fas fa-arrow-left"></i> Member Dashboard
    </a>
    <div class="user-avatar" id="adminAvatar">A</div>
  </div>
</header>

<main class="dashboard">
  <!-- Loading State -->
  <div class="loading-container" id="loadingContainer">
    <div class="loading-spinner"></div>
    <p>Loading Master Dashboard...</p>
  </div>
  
  <!-- Content -->
  <div id="dashboardContent" style="display: none;">
    <!-- Admin Banner -->
    <section class="admin-banner">
      <h1><i class="fas fa-crown"></i> Master Control Panel</h1>
      <p id="welcomeMessage">Welcome to the SODIUM Master Dashboard. Manage users, roles, and system settings.</p>
      
      <div class="admin-stats">
        <div class="admin-stat-card">
          <div class="stat-icon"><i class="fas fa-users"></i></div>
          <div class="stat-value" id="totalUsers">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon"><i class="fas fa-user-shield"></i></div>
          <div class="stat-value" id="adminUsersCount">0</div>
          <div class="stat-label">Admin Users</div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon"><i class="fas fa-clock"></i></div>
          <div class="stat-value" id="pendingApplications">0</div>
          <div class="stat-label">Role Applications</div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon"><i class="fas fa-calendar"></i></div>
          <div class="stat-value" id="activeEvents">3</div>
          <div class="stat-label">Active Events</div>
        </div>
      </div>
      
      <div class="admin-actions">
        <button class="admin-btn" id="goToRoleApplications">
          <i class="fas fa-file-alt"></i> Review Role Applications
        </button>
        <button class="admin-btn secondary" id="exportDataBtn">
          <i class="fas fa-download"></i> Export Data
        </button>
        <button class="admin-btn danger" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </section>
    
    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <!-- Admin Role Assignment Card -->
      <div class="admin-card">
        <div class="card-header">
          <h3><i class="fas fa-user-shield"></i> Assign Admin Roles</h3>
          <span class="badge" id="adminUsersCount2">0 Admin Users</span>
        </div>
        
        <div style="margin-bottom: 30px;">
          <div class="message" id="assignRoleMessage"></div>
          
          <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <input type="text" id="searchUser" class="form-input" placeholder="Search users by name or email" style="flex: 1;">
            <button class="admin-btn" id="searchUserBtn">
              <i class="fas fa-search"></i> Search
            </button>
          </div>
          
          <!-- Search Results -->
          <div id="userSearchResults" style="display: none;">
            <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
              <div id="selectedUserInfo"></div>
            </div>
            
            <div style="margin-bottom: 20px;">
              <label style="color: #ccc; font-size: 14px; margin-bottom: 15px; display: block;">
                <i class="fas fa-user-tag"></i> Select Admin Role
              </label>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <!-- CEO -->
                <div class="admin-role-option" data-role="CEO">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                      <i class="fas fa-crown"></i>
                    </div>
                    <div>
                      <div style="font-weight: 600; color: #fff;">CEO</div>
                      <div style="font-size: 12px; color: #aaa;">Chief Executive Officer</div>
                    </div>
                  </div>
                </div>
                
                <!-- Operations Head -->
                <div class="admin-role-option" data-role="Operations Head">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                      <i class="fas fa-cogs"></i>
                    </div>
                    <div>
                      <div style="font-weight: 600; color: #fff;">Operations Head</div>
                      <div style="font-size: 12px; color: #aaa;">Manage daily operations</div>
                    </div>
                  </div>
                </div>
                
                <!-- Technical Lead -->
                <div class="admin-role-option" data-role="Technical Lead">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                      <i class="fas fa-code"></i>
                    </div>
                    <div>
                      <div style="font-weight: 600; color: #fff;">Technical Lead</div>
                      <div style="font-size: 12px; color: #aaa;">Lead technical projects</div>
                    </div>
                  </div>
                </div>
                
                <!-- Strategic Director -->
                <div class="admin-role-option" data-role="Strategic Director">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                      <i class="fas fa-chess-board"></i>
                    </div>
                    <div>
                      <div style="font-weight: 600; color: #fff;">Strategic Director</div>
                      <div style="font-size: 12px; color: #aaa;">Develop organization strategy</div>
                    </div>
                  </div>
                </div>
                
                <!-- Community Guidance Director -->
                <div class="admin-role-option" data-role="Community Guidance Director">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ec4899, #db2777); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                      <i class="fas fa-hands-helping"></i>
                    </div>
                    <div>
                      <div style="font-weight: 600; color: #fff;">Community Guidance Director</div>
                      <div style="font-size: 12px; color: #aaa;">Guide community development</div>
                    </div>
                  </div>
                </div>
                
                <!-- Media Manager -->
                <div class="admin-role-option" data-role="Media Manager">
                  <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                      <i class="fas fa-photo-video"></i>
                    </div>
                    <div>
                      <div style="font-weight: 600; color: #fff;">Media Manager</div>
                      <div style="font-size: 12px; color: #aaa;">Manage media operations</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div style="margin-bottom: 20px;">
              <label style="color: #ccc; font-size: 14px; margin-bottom: 15px; display: block;">
                <i class="fas fa-key"></i> Permissions
              </label>
              <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px;">
                <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px; cursor: pointer;">
                  <input type="checkbox" id="permissionDashboard" checked style="width: 18px; height: 18px;">
                  <span style="color: #ccc;">Access Admin Dashboard</span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px; cursor: pointer;">
                  <input type="checkbox" id="permissionUsers" checked style="width: 18px; height: 18px;">
                  <span style="color: #ccc;">Manage Users</span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px; cursor: pointer;">
                  <input type="checkbox" id="permissionRoles" checked style="width: 18px; height: 18px;">
                  <span style="color: #ccc;">Assign Roles</span>
                </label>
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                  <input type="checkbox" id="permissionContent" checked style="width: 18px; height: 18px;">
                  <span style="color: #ccc;">Manage Content</span>
                </label>
              </div>
            </div>
            
            <button class="admin-btn" id="assignAdminRoleBtn" style="width: 100%;">
              <i class="fas fa-user-shield"></i> Assign Admin Role
            </button>
          </div>
        </div>
        
        <!-- Current Admins List -->
        <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 25px;">
          <h4 style="color: #aaa; font-size: 14px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-users-cog"></i> Current Admin Team
          </h4>
          <div id="currentAdminsList" style="display: grid; gap: 15px;">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>
      
      <!-- Role Applications Overview Card -->
      <div class="admin-card">
        <div class="card-header">
          <h3><i class="fas fa-file-alt"></i> Recent Role Applications</h3>
          <a href="admin.html" style="color: var(--gold); text-decoration: none; font-size: 14px;">View All</a>
        </div>
        <div id="recentApplications">
          <!-- Populated by JavaScript -->
        </div>
      </div>
      
      <!-- System Health Card -->
      <div class="admin-card">
        <div class="card-header">
          <h3><i class="fas fa-heartbeat"></i> System Health</h3>
          <span class="badge">All Systems Go</span>
        </div>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
          <div style="background: rgba(16, 185, 129, 0.1); padding: 20px; border-radius: 12px; text-align: center;">
            <i class="fas fa-database" style="color: #10b981; font-size: 24px; margin-bottom: 10px;"></i>
            <div style="font-size: 12px; color: #aaa;">Database</div>
            <div style="font-size: 18px; font-weight: 600; color: #4ade80;">100%</div>
          </div>
          <div style="background: rgba(59, 130, 246, 0.1); padding: 20px; border-radius: 12px; text-align: center;">
            <i class="fas fa-server" style="color: #3b82f6; font-size: 24px; margin-bottom: 10px;"></i>
            <div style="font-size: 12px; color: #aaa;">Server</div>
            <div style="font-size: 18px; font-weight: 600; color: #60a5fa;">99.9%</div>
          </div>
          <div style="background: rgba(245, 158, 11, 0.1); padding: 20px; border-radius: 12px; text-align: center;">
            <i class="fas fa-network-wired" style="color: #f59e0b; font-size: 24px; margin-bottom: 10px;"></i>
            <div style="font-size: 12px; color: #aaa;">Network</div>
            <div style="font-size: 18px; font-weight: 600; color: #fbbf24;">100%</div>
          </div>
          <div style="background: rgba(139, 92, 246, 0.1); padding: 20px; border-radius: 12px; text-align: center;">
            <i class="fas fa-shield-alt" style="color: #8b5cf6; font-size: 24px; margin-bottom: 10px;"></i>
            <div style="font-size: 12px; color: #aaa;">Security</div>
            <div style="font-size: 18px; font-weight: 600; color: #a78bfa;">100%</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  // Check admin authentication
  const adminUser = JSON.parse(localStorage.getItem('sodium_admin_user') || 'null');
  if (!adminUser) {
    window.location.href = 'login.html';
    return;
  }
  
  // Update admin avatar
  const adminAvatar = document.getElementById('adminAvatar');
  adminAvatar.textContent = adminUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
  document.getElementById('welcomeMessage').innerHTML = `Welcome, ${adminUser.name}. Manage SODIUM from the master control panel.`;
  
  // Load dashboard data
  await loadDashboardData();
  
  // Setup event listeners
  setupEventListeners(adminUser);
});

async function loadDashboardData() {
  try {
    // Load users from localStorage (or Firebase)
    const users = JSON.parse(localStorage.getItem('sodium_users') || '[]');
    const applications = JSON.parse(localStorage.getItem('sodium_role_applications') || '[]');
    
    // Update stats
    const totalUsers = users.length;
    const adminUsers = users.filter(u => u.adminRole).length;
    const pendingApps = applications.filter(a => a.status === 'pending').length;
    
    document.getElementById('totalUsers').textContent = totalUsers;
    document.getElementById('adminUsersCount').textContent = adminUsers;
    document.getElementById('adminUsersCount2').textContent = `${adminUsers} Admin Users`;
    document.getElementById('pendingApplications').textContent = pendingApps;
    
    // Load current admins
    loadCurrentAdmins(users);
    
    // Load recent applications
    loadRecentApplications(applications);
    
    // Hide loading, show content
    document.getElementById('loadingContainer').style.display = 'none';
    document.getElementById('dashboardContent').style.display = 'block';
    
  } catch (error) {
    console.error('Error loading dashboard:', error);
  }
}

function loadCurrentAdmins(users) {
  const admins = users.filter(user => user.adminRole);
  const currentAdminsList = document.getElementById('currentAdminsList');
  
  if (admins.length === 0) {
    currentAdminsList.innerHTML = `
      <div style="text-align: center; padding: 30px; background: rgba(255,255,255,0.03); border-radius: 12px;">
        <i class="fas fa-user-shield" style="font-size: 36px; color: #aaa; margin-bottom: 15px;"></i>
        <p style="color: #aaa;">No admin users assigned yet</p>
      </div>
    `;
    return;
  }
  
  currentAdminsList.innerHTML = '';
  admins.forEach(admin => {
    const initials = admin.name.split(' ').map(n => n[0]).join('').toUpperCase();
    const roleColors = {
      'CEO': 'linear-gradient(135deg, #fbbf24, #f59e0b)',
      'Operations Head': 'linear-gradient(135deg, #3b82f6, #1d4ed8)',
      'Technical Lead': 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
      'Strategic Director': 'linear-gradient(135deg, #10b981, #059669)',
      'Community Guidance Director': 'linear-gradient(135deg, #ec4899, #db2777)',
      'Media Manager': 'linear-gradient(135deg, #f59e0b, #d97706)'
    };
    
    const adminCard = document.createElement('div');
    adminCard.style.cssText = `
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: all 0.3s;
    `;
    
    adminCard.innerHTML = `
      <div style="width: 45px; height: 45px; background: ${roleColors[admin.adminRole] || 'linear-gradient(135deg, var(--gold), #f59e0b)'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700;">
        ${initials}
      </div>
      <div style="flex: 1;">
        <div style="font-weight: 600; color: #fff; margin-bottom: 4px;">${admin.name}</div>
        <div style="color: #aaa; font-size: 12px; margin-bottom: 6px;">${admin.email}</div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <span style="background: rgba(251, 191, 36, 0.2); color: var(--gold); padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600;">
            ${admin.adminRole}
          </span>
          <span style="color: #666; font-size: 11px;">
            <i class="fas fa-calendar"></i> ${admin.roleAssignedAt ? new Date(admin.roleAssignedAt).toLocaleDateString() : 'Recently'}
          </span>
        </div>
      </div>
      <button class="admin-btn" onclick="removeAdminRole('${admin.uid}')" style="padding: 8px 16px; background: rgba(239,68,68,0.1); color: #f87171; border: none; border-radius: 8px; font-size: 12px;">
        <i class="fas fa-times"></i> Remove
      </button>
    `;
    
    currentAdminsList.appendChild(adminCard);
  });
}

function loadRecentApplications(applications) {
  const recentApps = applications
    .filter(app => app.status === 'pending')
    .sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt))
    .slice(0, 5);
  
  const container = document.getElementById('recentApplications');
  
  if (recentApps.length === 0) {
    container.innerHTML = `
      <div style="text-align: center; padding: 30px; background: rgba(255,255,255,0.03); border-radius: 12px;">
        <i class="fas fa-inbox" style="font-size: 36px; color: #aaa; margin-bottom: 15px;"></i>
        <p style="color: #aaa;">No pending role applications</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = '';
  recentApps.forEach(app => {
    const appDate = new Date(app.submittedAt).toLocaleDateString();
    const appItem = document.createElement('div');
    appItem.style.cssText = `
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
      cursor: pointer;
      transition: all 0.3s;
    `;
    
    appItem.innerHTML = `
      <div style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--gold), #f59e0b); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
        <i class="fas fa-file-alt"></i>
      </div>
      <div style="flex: 1;">
        <div style="font-weight: 600; color: #fff; margin-bottom: 4px;">${app.name}</div>
        <div style="color: #aaa; font-size: 12px;">Applied for: ${app.role}</div>
      </div>
      <span style="background: rgba(245,158,11,0.2); color: #f59e0b; padding: 4px 8px; border-radius: 12px; font-size: 11px;">${appDate}</span>
    `;
    
    appItem.onclick = () => window.location.href = 'admin.html';
    container.appendChild(appItem);
  });
}

function setupEventListeners(adminUser) {
  // Logout
  document.getElementById('logoutBtn').addEventListener('click', async () => {
    try {
      localStorage.removeItem('sodium_admin_user');
      window.location.href = 'login.html';
    } catch (error) {
      console.error('Logout error:', error);
    }
  });
  
  // Go to role applications
  document.getElementById('goToRoleApplications').addEventListener('click', () => {
    window.location.href = 'admin.html';
  });
  
  // Export data
  document.getElementById('exportDataBtn').addEventListener('click', () => {
    const users = JSON.parse(localStorage.getItem('sodium_users') || '[]');
    const data = {
      exportedBy: adminUser.name,
      exportedAt: new Date().toISOString(),
      totalUsers: users.length,
      adminUsers: users.filter(u => u.adminRole).length,
      users: users.map(u => ({
        name: u.name,
        email: u.email,
        role: u.adminRole || 'Member',
        joined: u.createdAt
      }))
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
    const link = document.createElement('a');
    link.href = dataUri;
    link.download = `sodium_export_${new Date().toISOString().split('T')[0]}.json`;
    link.click();
  });
  
  // Admin role assignment setup
  setupAdminRoleAssignment();
}

function setupAdminRoleAssignment() {
  const searchBtn = document.getElementById('searchUserBtn');
  const searchInput = document.getElementById('searchUser');
  const resultsDiv = document.getElementById('userSearchResults');
  const assignBtn = document.getElementById('assignAdminRoleBtn');
  
  let selectedUser = null;
  let selectedRole = null;
  
  // Search user
  searchBtn.addEventListener('click', () => {
    const searchTerm = searchInput.value.trim().toLowerCase();
    if (!searchTerm) {
      showMessage('Please enter a name or email to search', 'error');
      return;
    }
    
    const users = JSON.parse(localStorage.getItem('sodium_users') || '[]');
    const foundUser = users.find(u => 
      u.name.toLowerCase().includes(searchTerm) || 
      u.email.toLowerCase().includes(searchTerm)
    );
    
    if (foundUser) {
      selectedUser = foundUser;
      const initials = foundUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
      
      document.getElementById('selectedUserInfo').innerHTML = `
        <div style="display: flex; align-items: center; gap: 20px;">
          <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--gold), #f59e0b); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px;">
            ${initials}
          </div>
          <div>
            <div style="font-weight: 600; color: #fff; font-size: 18px; margin-bottom: 5px;">${foundUser.name}</div>
            <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">${foundUser.email}</div>
            <div style="color: #ccc; font-size: 13px;">
              <span style="color: var(--gold);">Current Role:</span> ${foundUser.adminRole || 'Member'}
            </div>
          </div>
        </div>
      `;
      
      resultsDiv.style.display = 'block';
      showMessage('', 'success'); // Clear message
      
    } else {
      showMessage('No user found with that name or email', 'error');
    }
  });
  
  // Role selection
  document.querySelectorAll('.admin-role-option').forEach(option => {
    option.addEventListener('click', function() {
      // Remove selection from all
      document.querySelectorAll('.admin-role-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Add selection to this
      this.classList.add('selected');
      selectedRole = this.getAttribute('data-role');
    });
  });
  
  // Assign role
  assignBtn.addEventListener('click', () => {
    if (!selectedUser) {
      showMessage('Please search and select a user first', 'error');
      return;
    }
    
    if (!selectedRole) {
      showMessage('Please select an admin role to assign', 'error');
      return;
    }
    
    if (confirm(`Assign ${selectedRole} role to ${selectedUser.name}?`)) {
      // Get permissions
      const permissions = {
        dashboard: document.getElementById('permissionDashboard').checked,
        users: document.getElementById('permissionUsers').checked,
        roles: document.getElementById('permissionRoles').checked,
        content: document.getElementById('permissionContent').checked
      };
      
      // Update user in localStorage
      const users = JSON.parse(localStorage.getItem('sodium_users') || '[]');
      const userIndex = users.findIndex(u => u.uid === selectedUser.uid);
      
      if (userIndex !== -1) {
        users[userIndex].adminRole = selectedRole;
        users[userIndex].adminPermissions = permissions;
        users[userIndex].roleAssignedBy = JSON.parse(localStorage.getItem('sodium_admin_user')).name;
        users[userIndex].roleAssignedAt = new Date().toISOString();
        
        localStorage.setItem('sodium_users', JSON.stringify(users));
        
        // Update user's individual storage
        localStorage.setItem(`sodium_user_data_${selectedUser.uid}`, JSON.stringify(users[userIndex]));
        
        // Refresh UI
        showMessage(`✓ ${selectedRole} role assigned to ${selectedUser.name}`, 'success');
        loadCurrentAdmins(users);
        
        // Reset form
        searchInput.value = '';
        resultsDiv.style.display = 'none';
        selectedUser = null;
        selectedRole = null;
        document.querySelectorAll('.admin-role-option').forEach(opt => {
          opt.classList.remove('selected');
        });
      }
    }
  });
}

function showMessage(message, type) {
  const messageDiv = document.getElementById('assignRoleMessage');
  messageDiv.textContent = message;
  messageDiv.className = `message ${type}`;
  messageDiv.style.display = 'block';
  
  if (message) {
    setTimeout(() => {
      messageDiv.style.display = 'none';
    }, 5000);
  }
}

// Remove admin role function
window.removeAdminRole = function(userId) {
  if (confirm('Are you sure you want to remove this admin role?')) {
    const users = JSON.parse(localStorage.getItem('sodium_users') || '[]');
    const userIndex = users.findIndex(u => u.uid === userId);
    
    if (userIndex !== -1) {
      const userName = users[userIndex].name;
      users[userIndex].adminRole = null;
      users[userIndex].adminPermissions = null;
      
      localStorage.setItem('sodium_users', JSON.stringify(users));
      localStorage.removeItem(`sodium_user_data_${userId}`);
      
      loadCurrentAdmins(users);
      showMessage(`✓ Admin role removed from ${userName}`, 'success');
    }
  }
};
</script>
</body>
</html>

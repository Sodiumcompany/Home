<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SODIUM â€¢ Master Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Add Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyAUVsLH-YZdbhnH5U8tuS-31bTrPz6CZ8g",
    authDomain: "sodium-b5392.firebaseapp.com",
    projectId: "sodium-b5392",
    storageBucket: "sodium-b5392.firebasestorage.app",
    messagingSenderId: "21034072519",
    appId: "1:21034072519:web:258c82eb4cfed599c301e2",
    measurementId: "G-E0F44QQMD0"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  
  window.firebaseAdmin = { db, collection, getDocs, doc, updateDoc, deleteDoc };
</script>
<style>
:root {
  --bg-dark: #050505;
  --purple: #a855f7;
  --blue: #6366f1;
  --glass: rgba(255, 255, 255, 0.05);
  --glass-border: rgba(255,255,255,0.15);
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --gold: #fbbf24;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
html{scroll-behavior:smooth;}
body{background: var(--bg-dark); color:#fff; overflow-x:hidden;}

/* Animated Background Blobs */
.blob {position:fixed; border-radius:50%; filter: blur(80px); z-index:-1;}
.blob1{width:500px;height:500px; background:radial-gradient(circle,#a855f780,transparent); top:10%; left:10%; animation:move1 25s infinite alternate;}
.blob2{width:600px;height:600px; background:radial-gradient(circle,#6366f180,transparent); bottom:0; right:5%; animation:move2 30s infinite alternate;}
@keyframes move1{0%{transform:translate(0,0);}100%{transform:translate(50px,60px);}}
@keyframes move2{0%{transform:translate(0,0);}100%{transform:translate(-70px,-40px);}}

/* Header */
header {
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 60px;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-icon {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--purple), var(--blue));
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 20px;
}

.logo-text {
  font-weight: 700;
  color: #fff;
  font-size: 22px;
  letter-spacing: 2px;
}

.logo-text span {
  color: var(--purple);
}

.admin-badge {
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  color: #000;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  margin-left: 10px;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

nav {
  display: flex;
  gap: 30px;
  align-items: center;
}

nav a {
  text-decoration: none;
  color: #fff;
  font-weight: 500;
  font-size: 15px;
  position: relative;
  padding: 8px 0;
  transition: all 0.3s;
}

nav a::after {
  content: '';
  position: absolute;
  left: 0;
  bottom: 0;
  width: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--gold), #f59e0b);
  transition: width 0.3s;
}

nav a:hover::after {
  width: 100%;
}

nav a.active {
  color: var(--gold);
}

nav a.active::after {
  width: 100%;
}

.user-menu {
  display: flex;
  align-items: center;
  gap: 15px;
}

.user-avatar {
  width: 45px;
  height: 45px;
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: #000;
  cursor: pointer;
}

/* Master Dashboard */
.dashboard {
  padding: 150px 60px 60px;
  max-width: 1600px;
  margin: 0 auto;
}

/* Admin Banner */
.admin-banner {
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
  border: 1px solid rgba(251, 191, 36, 0.3);
  border-radius: 24px;
  padding: 40px;
  margin-bottom: 40px;
  position: relative;
  overflow: hidden;
}

.admin-banner::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.03)"/></svg>');
  background-size: cover;
}

.admin-content {
  position: relative;
  z-index: 1;
}

.admin-content h1 {
  font-size: 36px;
  margin-bottom: 10px;
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  display: flex;
  align-items: center;
  gap: 15px;
}

.admin-content p {
  color: #ccc;
  font-size: 16px;
  max-width: 600px;
  margin-bottom: 30px;
}

.admin-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.admin-stat-card {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 16px;
  padding: 25px;
  text-align: center;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}

.admin-stat-card:hover {
  transform: translateY(-5px);
  border-color: var(--gold);
  box-shadow: 0 10px 20px rgba(251, 191, 36, 0.2);
}

.admin-stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(135deg, var(--gold), #f59e0b);
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 5px;
  color: var(--gold);
}

.stat-label {
  font-size: 14px;
  color: #aaa;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.stat-change {
  font-size: 12px;
  margin-top: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
}

.stat-change.positive {
  color: var(--success);
}

.stat-change.negative {
  color: var(--danger);
}

.stat-icon {
  font-size: 28px;
  margin-bottom: 15px;
  color: var(--gold);
}

/* Quick Actions */
.admin-actions {
  display: flex;
  gap: 15px;
  margin-top: 20px;
  flex-wrap: wrap;
}

.admin-btn {
  padding: 12px 24px;
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  color: #000;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.admin-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(251, 191, 36, 0.3);
}

.admin-btn.secondary {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.2);
  color: #ccc;
}

.admin-btn.secondary:hover {
  background: rgba(255,255,255,0.05);
  border-color: var(--gold);
  color: #fff;
}

.admin-btn.danger {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.2);
  color: #f87171;
}

.admin-btn.danger:hover {
  background: rgba(239, 68, 68, 0.2);
  border-color: var(--danger);
}

/* Dashboard Grid */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 30px;
  margin-top: 40px;
}

.admin-card {
  background: var(--glass);
  backdrop-filter: blur(15px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  padding: 30px;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}

.admin-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 20px 40px rgba(168, 85, 247, 0.2);
}

.admin-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(135deg, var(--gold), #f59e0b);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.card-header h3 {
  font-size: 20px;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card-header .badge {
  background: linear-gradient(135deg, var(--gold), #f59e0b);
  color: #000;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

/* Users Table */
.users-table-container {
  overflow-x: auto;
}

.users-table {
  width: 100%;
  border-collapse: collapse;
}

.users-table th {
  text-align: left;
  padding: 15px;
  background: rgba(255,255,255,0.05);
  color: #aaa;
  font-weight: 600;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 1px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.users-table td {
  padding: 15px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  color: #ccc;
}

.users-table tr:hover {
  background: rgba(255,255,255,0.03);
}

.user-role {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.role-admin {
  background: rgba(251, 191, 36, 0.2);
  color: var(--gold);
}

.role-member {
  background: rgba(59, 130, 246, 0.2);
  color: #60a5fa;
}

.user-status {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.status-active {
  background: rgba(34, 197, 94, 0.2);
  color: #4ade80;
}

.status-inactive {
  background: rgba(239, 68, 68, 0.2);
  color: #f87171;
}

.user-actions {
  display: flex;
  gap: 8px;
}

.action-icon {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
}

.action-icon.edit {
  background: rgba(59, 130, 246, 0.1);
  color: #60a5fa;
}

.action-icon.edit:hover {
  background: rgba(59, 130, 246, 0.2);
}

.action-icon.delete {
  background: rgba(239, 68, 68, 0.1);
  color: #f87171;
}

.action-icon.delete:hover {
  background: rgba(239, 68, 68, 0.2);
}

.action-icon.view {
  background: rgba(34, 197, 94, 0.1);
  color: #4ade80;
}

.action-icon.view:hover {
  background: rgba(34, 197, 94, 0.2);
}

/* Department Stats */
.departments-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.dept-stat-card {
  background: rgba(255,255,255,0.03);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  transition: all 0.3s;
}

.dept-stat-card:hover {
  background: rgba(168, 85, 247, 0.1);
  transform: translateY(-5px);
}

.dept-stat-value {
  font-size: 24px;
  font-weight: 700;
  color: #fff;
  margin-bottom: 5px;
}

.dept-stat-label {
  font-size: 12px;
  color: #aaa;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.dept-stat-growth {
  font-size: 11px;
  margin-top: 5px;
  color: var(--success);
}

/* Recent Activity */
.activity-list {
  list-style: none;
}

.activity-item {
  display: flex;
  align-items: center;
  padding: 15px;
  border-radius: 12px;
  margin-bottom: 10px;
  background: rgba(255,255,255,0.03);
  transition: all 0.3s;
}

.activity-item:hover {
  background: rgba(255,255,255,0.05);
}

.activity-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  background: linear-gradient(135deg, var(--purple), var(--blue));
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 15px;
  font-size: 16px;
}

.activity-details {
  flex: 1;
}

.activity-title {
  font-weight: 600;
  margin-bottom: 5px;
  color: #fff;
}

.activity-time {
  font-size: 13px;
  color: #aaa;
}

.activity-user {
  font-size: 13px;
  color: var(--gold);
}

/* System Health */
.system-health {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.health-item {
  background: rgba(255,255,255,0.03);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
}

.health-item.good {
  border: 1px solid rgba(34, 197, 94, 0.3);
}

.health-item.warning {
  border: 1px solid rgba(245, 158, 11, 0.3);
}

.health-item.critical {
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.health-icon {
  font-size: 24px;
  margin-bottom: 10px;
}

.health-item.good .health-icon {
  color: var(--success);
}

.health-item.warning .health-icon {
  color: var(--warning);
}

.health-item.critical .health-icon {
  color: var(--danger);
}

.health-label {
  font-size: 13px;
  color: #aaa;
  margin-bottom: 5px;
}

.health-value {
  font-weight: 700;
  font-size: 18px;
  color: #fff;
}

/* Loading State */
.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 70vh;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(255,255,255,0.1);
  border-radius: 50%;
  border-top-color: var(--gold);
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(10px);
  z-index: 2000;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: var(--bg-dark);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 20px;
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
}

.modal-header {
  padding: 25px 30px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h3 {
  font-size: 20px;
  color: #fff;
}

.close-modal {
  background: none;
  border: none;
  color: #aaa;
  font-size: 24px;
  cursor: pointer;
  transition: color 0.3s;
}

.close-modal:hover {
  color: #fff;
}

.modal-body {
  padding: 30px;
}

/* Animations */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.admin-card {
  animation: fadeInUp 0.6s ease forwards;
}

/* Responsive */
@media (max-width: 1200px) {
  .dashboard {
    padding: 140px 40px 40px;
  }
  
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 768px) {
  header {
    padding: 15px 25px;
  }
  
  .dashboard {
    padding: 130px 25px 40px;
  }
  
  .admin-banner {
    padding: 30px 25px;
  }
  
  .admin-stats {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .admin-actions {
    flex-direction: column;
  }
  
  nav {
    gap: 15px;
  }
  
  nav a span {
    display: none;
  }
  
  nav a i {
    font-size: 18px;
  }
}

@media (max-width: 576px) {
  .admin-stats {
    grid-template-columns: 1fr;
  }
  
  .logo-text {
    font-size: 18px;
  }
  
  .admin-badge {
    font-size: 10px;
    padding: 3px 8px;
  }
}
</style>
</head>
<body>
<div class="blob blob1"></div>
<div class="blob blob2"></div>

<header>
  <div class="logo">
    <div class="logo-icon">S</div>
    <div class="logo-text">SOD<span>IUM</span><span class="admin-badge"><i class="fas fa-crown"></i> MASTER ADMIN</span></div>
  </div>
  
  <nav>
    <a href="#" class="active"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a>
    <a href="#"><i class="fas fa-users"></i> <span>Users</span></a>
    <a href="#"><i class="fas fa-chart-bar"></i> <span>Analytics</span></a>
    <a href="#"><i class="fas fa-cog"></i> <span>Settings</span></a>
  </nav>
  
  <div class="user-menu">
    <div class="user-avatar" id="adminAvatar">A</div>
  </div>
</header>

<main class="dashboard">
  <!-- Loading State -->
  <div class="loading-container" id="loadingContainer">
    <div class="loading-spinner"></div>
    <p>Loading Master Dashboard...</p>
  </div>
  
  <!-- Content (hidden initially) -->
  <div id="dashboardContent" style="display: none;">
    <!-- Admin Banner -->
    <section class="admin-banner">
      <div class="admin-content">
        <h1><i class="fas fa-crown"></i> Master Control Panel</h1>
        <p>Welcome to the SODIUM Master Dashboard. Monitor and manage all system activities from here.</p>
        
        <div class="admin-stats">
          <div class="admin-stat-card">
            <div class="stat-icon"><i class="fas fa-users"></i></div>
            <div class="stat-value" id="totalUsers">0</div>
            <div class="stat-label">Total Users</div>
            <div class="stat-change positive" id="userGrowth"><i class="fas fa-arrow-up"></i> 12% this month</div>
          </div>
          
          <div class="admin-stat-card">
            <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
            <div class="stat-value" id="activeEvents">0</div>
            <div class="stat-label">Active Events</div>
            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 3 upcoming</div>
          </div>
          
          <div class="admin-stat-card">
            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
            <div class="stat-value" id="engagementRate">0%</div>
            <div class="stat-label">Engagement Rate</div>
            <div class="stat-change positive"><i class="fas fa-arrow-up"></i> 8% increase</div>
          </div>
          
          <div class="admin-stat-card">
            <div class="stat-icon"><i class="fas fa-server"></i></div>
            <div class="stat-value" id="systemHealth">100%</div>
            <div class="stat-label">System Health</div>
            <div class="stat-change positive"><i class="fas fa-check-circle"></i> All systems OK</div>
          </div>
        </div>
        
        <div class="admin-actions">
          <button class="admin-btn" id="addUserBtn">
            <i class="fas fa-user-plus"></i> Add User
          </button>
          <button class="admin-btn secondary" id="createEventBtn">
            <i class="fas fa-calendar-plus"></i> Create Event
          </button>
          <button class="admin-btn secondary" id="exportDataBtn">
            <i class="fas fa-download"></i> Export Data
          </button>
          <button class="admin-btn danger" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>
    </section>
    
    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <!-- Users Management Card -->
      <div class="admin-card">
        <div class="card-header">
          <h3><i class="fas fa-users-cog"></i> User Management</h3>
          <span class="badge" id="onlineUsers">0 Online</span>
        </div>
        <div class="users-table-container">
          <table class="users-table" id="usersTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Joined</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTableBody">
              <!-- Will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Departments Analytics -->
      <div class="admin-card">
        <div class="card-header">
          <h3><i class="fas fa-building"></i> Departments Analytics</h3>
          <a href="#" style="color: var(--gold); text-decoration: none; font-size: 14px;">View Details</a>
        </div>
        <div class="departments-stats">
          <div class="dept-stat-card">
            <div class="dept-stat-value" id="itMembers">0</div>
            <div class="dept-stat-label">IT Department</div>
            <div class="dept-stat-growth">+5 this month</div>
          </div>
          <div class="dept-stat-card">
            <div class="dept-stat-value" id="mediaMembers">0</div>
            <div class="dept-stat-label">Media Department</div>
            <div class="dept-stat-growth">+3 this month</div>
          </div>
          <div class="dept-stat-card">
            <div class="dept-stat-value" id="gamingMembers">0</div>
            <div class="dept-stat-label">Gaming Department</div>
            <div class="dept-stat-growth">+7 this month</div>
          </div>
        </div>
      </div>
      
      <!-- Recent Activity -->
      <div class="admin-card">
        <div class="card-header">
          <h3><i class="fas fa-history"></i> Recent Activity</h3>
          <a href="#" style="color: var(--gold); text-decoration: none; font-size: 14px;">View All</a>
        </div>
        <ul class="activity-list" id="activityList">
          <!-- Will be populated by JavaScript -->
        </ul>
      </div>
      
      <!-- System Health -->
      <div class="admin-card">
        <div class="card-header">
          <h3><i class="fas fa-heartbeat"></i> System Health</h3>
          <span class="badge">All Systems Go</span>
        </div>
        <div class="system-health">
          <div class="health-item good">
            <div class="health-icon"><i class="fas fa-database"></i></div>
            <div class="health-label">Database</div>
            <div class="health-value">100%</div>
          </div>
          <div class="health-item good">
            <div class="health-icon"><i class="fas fa-server"></i></div>
            <div class="health-label">Server</div>
            <div class="health-value">99.9%</div>
          </div>
          <div class="health-item good">
            <div class="health-icon"><i class="fas fa-network-wired"></i></div>
            <div class="health-label">Network</div>
            <div class="health-value">100%</div>
          </div>
          <div class="health-item good">
            <div class="health-icon"><i class="fas fa-shield-alt"></i></div>
            <div class="health-label">Security</div>
            <div class="health-value">100%</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Add User Modal -->
<div class="modal" id="addUserModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3><i class="fas fa-user-plus"></i> Add New User</h3>
      <button class="close-modal" id="closeAddUserModal">&times;</button>
    </div>
    <div class="modal-body">
      <div id="modalMessage"></div>
      <form id="addUserForm">
        <div style="display: grid; gap: 20px;">
          <div>
            <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 14px;">Full Name</label>
            <input type="text" id="newUserName" class="form-input" placeholder="Enter full name" required style="width: 100%;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 14px;">Email</label>
            <input type="email" id="newUserEmail" class="form-input" placeholder="Enter email" required style="width: 100%;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 14px;">Role</label>
            <select id="newUserRole" class="form-input" style="width: 100%;">
              <option value="member">Member</option>
              <option value="admin">Admin</option>
              <option value="moderator">Moderator</option>
            </select>
          </div>
          <div>
            <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 14px;">Department</label>
            <select id="newUserDepartment" class="form-input" style="width: 100%;">
              <option value="it">IT Department</option>
              <option value="media">Media Department</option>
              <option value="gaming">Gaming Department</option>
              <option value="none">None</option>
            </select>
          </div>
          <button type="submit" class="admin-btn" style="width: 100%;">
            <i class="fas fa-save"></i> Create User
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  // Check admin authentication
  const adminUser = localStorage.getItem('sodium_admin_user');
  if (!adminUser) {
    window.location.href = 'login.html';
    return;
  }
  
  const adminData = JSON.parse(adminUser);
  
  // Update admin avatar
  const adminAvatar = document.getElementById('adminAvatar');
  const adminName = adminData.name.split(' ').map(n => n[0]).join('').toUpperCase();
  adminAvatar.textContent = adminName;
  
  // Wait for Firebase to load
  await new Promise(resolve => {
    const checkFirebase = setInterval(() => {
      if (window.firebaseAdmin) {
        clearInterval(checkFirebase);
        resolve();
      }
    }, 100);
  });
  
  const { db, collection, getDocs } = window.firebaseAdmin;
  
  // Load dashboard data
  loadDashboardData(adminData);
  
  // Setup event listeners
  setupEventListeners(adminData);
  
  async function loadDashboardData(adminData) {
    try {
      // Load users from Firestore
      const usersSnapshot = await getDocs(collection(db, 'users'));
      const users = [];
      usersSnapshot.forEach(doc => {
        users.push({ id: doc.id, ...doc.data() });
      });
      
      // Hide loading, show content
      document.getElementById('loadingContainer').style.display = 'none';
      document.getElementById('dashboardContent').style.display = 'block';
      
      // Update stats
      updateStats(users);
      
      // Populate users table
      populateUsersTable(users);
      
      // Populate activity list
      populateActivityList(users);
      
    } catch (error) {
      console.error('Error loading dashboard data:', error);
      document.getElementById('loadingContainer').innerHTML = `
        <div style="text-align: center;">
          <div style="color: #f87171; font-size: 48px; margin-bottom: 20px;">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <h3 style="color: #fff; margin-bottom: 10px;">Error Loading Data</h3>
          <p style="color: #aaa;">${error.message}</p>
          <button class="admin-btn" onclick="location.reload()" style="margin-top: 20px;">
            <i class="fas fa-redo"></i> Retry
          </button>
        </div>
      `;
    }
  }
  
  function updateStats(users) {
    // Total users
    document.getElementById('totalUsers').textContent = users.length;
    
    // Online users (simulated)
    const onlineCount = Math.floor(users.length * 0.3); // 30% online
    document.getElementById('onlineUsers').textContent = `${onlineCount} Online`;
    
    // Active events
    document.getElementById('activeEvents').textContent = '3';
    
    // Engagement rate
    document.getElementById('engagementRate').textContent = '78%';
    
    // System health
    document.getElementById('systemHealth').textContent = '100%';
    
    // Department stats
    document.getElementById('itMembers').textContent = Math.floor(users.length * 0.4);
    document.getElementById('mediaMembers').textContent = Math.floor(users.length * 0.3);
    document.getElementById('gamingMembers').textContent = Math.floor(users.length * 0.3);
  }
  
  function populateUsersTable(users) {
    const tableBody = document.getElementById('usersTableBody');
    tableBody.innerHTML = '';
    
    // Sort users by join date (newest first)
    users.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    
    // Show first 10 users
    users.slice(0, 10).forEach(user => {
      const row = document.createElement('tr');
      
      // Format join date
      const joinDate = new Date(user.createdAt).toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric'
      });
      
      row.innerHTML = `
        <td>
          <div style="display: flex; align-items: center; gap: 10px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, var(--purple), var(--blue)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px;">
              ${user.name.split(' ').map(n => n[0]).join('').toUpperCase()}
            </div>
            <div>
              <div style="font-weight: 600; color: #fff;">${user.name}</div>
              <div style="font-size: 12px; color: #aaa;">@${user.username}</div>
            </div>
          </div>
        </td>
        <td>${user.email}</td>
        <td><span class="user-role ${user.role === 'admin' ? 'role-admin' : 'role-member'}">${user.role}</span></td>
        <td><span class="user-status status-active">Active</span></td>
        <td>${joinDate}</td>
        <td>
          <div class="user-actions">
            <div class="action-icon view" title="View Profile">
              <i class="fas fa-eye"></i>
            </div>
            <div class="action-icon edit" title="Edit User">
              <i class="fas fa-edit"></i>
            </div>
            <div class="action-icon delete" title="Delete User">
              <i class="fas fa-trash"></i>
            </div>
          </div>
        </td>
      `;
      
      tableBody.appendChild(row);
    });
  }
  
  function populateActivityList(users) {
    const activityList = document.getElementById('activityList');
    activityList.innerHTML = '';
    
    // Generate recent activity
    const activities = [
      { icon: 'fa-user-plus', title: 'New User Registered', user: users[0]?.name || 'John Doe', time: '5 minutes ago' },
      { icon: 'fa-calendar-check', title: 'Event Registration', user: users[1]?.name || 'Jane Smith', time: '1 hour ago' },
      { icon: 'fa-comment', title: 'Forum Post Created', user: users[2]?.name || 'Bob Johnson', time: '2 hours ago' },
      { icon: 'fa-trophy', title: 'Achievement Unlocked', user: users[3]?.name || 'Alice Brown', time: '5 hours ago' },
      { icon: 'fa-project-diagram', title: 'Project Submitted', user: users[4]?.name || 'Charlie Wilson', time: '1 day ago' }
    ];
    
    activities.forEach(activity => {
      const activityItem = document.createElement('li');
      activityItem.className = 'activity-item';
      activityItem.innerHTML = `
        <div class="activity-icon">
          <i class="fas ${activity.icon}"></i>
        </div>
        <div class="activity-details">
          <div class="activity-title">${activity.title}</div>
          <div class="activity-time">${activity.time}</div>
          <div class="activity-user">by ${activity.user}</div>
        </div>
      `;
      activityList.appendChild(activityItem);
    });
  }
  
  function setupEventListeners(adminData) {
    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('sodium_admin_user');
      window.location.href = 'login.html';
    });
    
    // Add User button
    document.getElementById('addUserBtn').addEventListener('click', () => {
      document.getElementById('addUserModal').style.display = 'flex';
    });
    
    // Close modal buttons
    document.getElementById('closeAddUserModal').addEventListener('click', () => {
      document.getElementById('addUserModal').style.display = 'none';
    });
    
    // Close modal when clicking outside
    document.getElementById('addUserModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('addUserModal')) {
        document.getElementById('addUserModal').style.display = 'none';
      }
    });
    
    // Create Event button
    document.getElementById('createEventBtn').addEventListener('click', () => {
      alert('Event creation feature coming soon!');
    });
    
    // Export Data button
    document.getElementById('exportDataBtn').addEventListener('click', () => {
      exportData();
    });
    
    // Add User form submission
    document.getElementById('addUserForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('newUserName').value.trim();
      const email = document.getElementById('newUserEmail').value.trim();
      const role = document.getElementById('newUserRole').value;
      const department = document.getElementById('newUserDepartment').value;
      
      if (!name || !email) {
        showModalMessage('Please fill in all required fields', 'error');
        return;
      }
      
      // Show success message (in real app, you would save to Firebase)
      showModalMessage(`User "${name}" added successfully! (Demo mode)`, 'success');
      
      // Reset form
      document.getElementById('addUserForm').reset();
      
      // Close modal after 2 seconds
      setTimeout(() => {
        document.getElementById('addUserModal').style.display = 'none';
        // Refresh user list
        location.reload();
      }, 2000);
    });
  }
  
  function showModalMessage(message, type) {
    const modalMessage = document.getElementById('modalMessage');
    modalMessage.textContent = message;
    modalMessage.className = `message ${type}`;
    modalMessage.style.display = 'block';
    
    setTimeout(() => {
      modalMessage.style.display = 'none';
    }, 5000);
  }
  
  function exportData() {
    // In a real app, you would fetch data from Firebase and create a CSV/JSON
    const data = {
      exportedBy: adminData.name,
      exportedAt: new Date().toISOString(),
      message: 'Data export feature will be implemented with Firebase integration'
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', `sodium_export_${new Date().toISOString().split('T')[0]}.json`);
    linkElement.click();
    
    alert('Export initiated! In a full implementation, this would download all user data.');
  }
});
</script>
</body>
</html>
